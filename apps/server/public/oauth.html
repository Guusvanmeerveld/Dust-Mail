<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Logging in...</title>
	</head>
	<body>
		<p id="text"></p>

		<noscript>Javascript is required for this login</noscript>

		<script>
			const accessToken = JSON.parse(`{{access_token}}`);
			const refreshToken = JSON.parse(`{{refresh_token}}`);
			const username = "{{username}}";

			document.getElementById("text").innerHTML = "Logging in, please wait...";

			if ("__TAURI__" in window) {
				window.__TAURI__.tauri.invoke("oauth_login_token", {
					config: JSON.stringify({
						tokens: [accessToken, refreshToken],
						username
					})
				});
			} else if ("opener" in window && "postMessage" in window.opener) {
				window.opener.postMessage(
					JSON.stringify({ tokens: [accessToken, refreshToken], username }),
					"*"
				);

				document.getElementById("text").innerHTML =
					"Login complete, you can now close this window.";
			} else {
				document.getElementById("text").innerHTML =
					"Thats weird, your browser does not support communication between browser windows. Please upgrade your browser or use another one.";
			}
		</script>
	</body>
</html>
